<html>
<head>

</head>
<body>
<script src="../../scripts/jquery.min.js"></script>
<script src="../../scripts/jquery-ui.js"></script>
<script src="../../scripts/xbbcode.js"></script>
<script src="../../scripts/qrcode.js"></script>
<script src="../../scripts/timeSince.js"></script>
<script src="../../scripts/zoom.js"></script>
<script src="../../scripts/bitcoinjs.js"></script>
<script src="../../scripts/peer.js"></script>
<script src="../../scripts/react.js"></script>
<script src="../../js/freeBeer/config.js"></script>
<script src="../../js/freeBeer/config_dev.js"></script>
<script src="../../js/core/Puffball.js"></script>
<script src="../../js/core/PuffNet.js"></script>
<script src="../../js/modules/PuffForum.js"></script>
<script src="../../js/modules/PuffWardrobe.js"></script>

<script>
    // Take a .json file, parse it, sign each puff, chain them together,
    // Maintain referential integrity of posts.
    var key2sig = {};
    var defaultKeyPrivate = '';
    var username = 'ishmael';
    // NOTE: does not confirm key validity in DHT
    PuffWardrobe.storePrivateKeys(username, '', '', defaultKeyPrivate);
    PuffWardrobe.switchCurrent(username);

    function createPuffs() {

        // Open json file
        var url   = 'http://localhost:8888/puffballApi/files/results.json';
        var data  = {};
        var prom = PuffNet.getJSON(url, data);
        var type = 'text';
        var metadata = {};
        metadata.author = 'hermanmelville';
        metadata.zones = ['mobydick','freebeer'];

        return prom.then(
                function(results) {
                    results.reverse();
                    rec(results)
                }
        );

        function rec(results) {
            var node = results.pop();
            var content = node.content;
            var id = node.id;
            var parents = (node.parents || []).map(function (parentId) {
                return key2sig[parentId];
            });

            var puffprom = PuffForum.addPost(type, content, parents, metadata);
            puffprom.then(function(puff) {
                key2sig[id] = puff.sig;
                setTimeout(function() {rec(results)}, 1000)
            })

        }

        // Begin signing each puff

        // do lookup in key2sig for each of the parents, replace id's with sigs

        //


    }

</script>
<form>
    Username: <input type="text" name="username" id="username"><br />
    Private key (default) <input type="text" name="defaultKey" id="defaultKey"><br />
    URL of JSON file: <input type="text" name="url" id="url"><br />


</form>


</body>

</html>

